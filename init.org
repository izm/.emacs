#+STARTUP: hidestars

* init.org
  This file must be tangled into =init.el= in the emacs configuration
  directory, =~/init.d/=.

   #+BEGIN_SRC emacs-lisp :tangle no :results output silent
     ;; Tangle this file into init.el, then load it.
     ;; Output logged in *Messages* buffer
     (message "Tangled and Loaded!\n  |- %s\n  |- %s\n  |- %s"

	      ;; tangled file name
	      (car 
	       (org-babel-tangle-file
		buffer-file-name
		(expand-file-name (concat user-emacs-directory "init.el"))
		"emacs-lisp"))

	      ;; date and time of tangle
	      (format-time-string "%Y-%m-%d.%H-%M-%S" (current-time))

	      ;; load tangled file
	      (load (concat user-emacs-directory "init.el")))
   #+END_SRC


** TODO Tangle to init.el [3/4]
   - [X] Add =:tangle no= to the eval block
   - [X] Remove =:tangle= header from source blocks.
   - [X] Add date completed
   - [ ] Add prompt before overwriting =init.el=.  OR... just do it and backup old one?

* Initialize
** package

   =(package-initialize)= must come before configurations of installed
   packages.

   #+BEGIN_SRC emacs-lisp
     ;; Do not edit this file.  See "init.org"
     ;; This file is generated from init.org using org-babel-tangle
     (setq package-enable-at-startup nil)
     (package-initialize)

     ;; packages: use up-to-date MELPA, not ELPA
     (when (>= emacs-major-version 24)
       (require 'package)
       (add-to-list
	'package-archives
	'("melpa" . "http://melpa.org/packages/")
	t)
       (package-initialize))
   #+END_SRC

** use-package
   
   Info about =use-package=: https://github.com/jwiegley/use-package

   #+BEGIN_SRC emacs-lisp
     (require 'use-package)                  ; we want this instead of 'require
     (setq use-package-always-ensure t)      ; ensure package is installed
     (setq use-package-verbose t) 		; report config loading time in *Messages*
   #+END_SRC

   Explicit =use-package= use: 

   #+BEGIN_SRC emacs-lisp :tangle no
     ;; (use-package expand-region
     ;;   :commands expand-region
     ;;   :init
     ;;   (bind-key "C-=" "expand-region"))    
   #+END_SRC

* Private
  Load things that should be slightly more private.
  #+BEGIN_SRC emacs-lisp
    (setq init_private_loaded (load "~/.emacs.d/init_private.el")) ;; ensure init_private.el is loaded
    ;; defines: my/user-dir, my/on-work-pc, my/user-name, my/computer-name, my/org-directory
  #+END_SRC

* Emacs
** User
   #+BEGIN_SRC emacs-lisp
   (setq user-full-name "Steven Brown")
   (setq user-mail-address "steven.w.j.brown@gmail.com")
   #+END_SRC

** General
   
   #+BEGIN_SRC emacs-lisp
     (setq ansi-color-faces-vector
	   [default bold shadow italic underline bold bold-italic bold])
     (setq fill-column 80)		; where to wrap lines; set locally with C-x f
     (set-default 'truncate-lines t)	; truncate long lines, don't wrap them
     (setq column-number-mode t)	; show column numbers in modeline
     (setq inhibit-startup-screen t)	; skip startup screen
     (setq tool-bar-mode nil)	; Remove clunky toolbar and icons
     (show-paren-mode t)		; highlight matching parentheses
     (global-hl-line-mode t)		; highlight current line
     (setq visible-bell t)		; blink, don't bark
     (setq x-stretch-cursor t) ; cursor width will match tab character width

     ;;(setq uniquify-buffer-name-style (quote forward) nil (uniquify))
     (setq uniquify-buffer-name-style (quote post-forward-angle-brackets))

     (desktop-save-mode 1)	       ; save the desktop/state of emacs' frames/buffers
     (setq backup-directory-alist `(("." . "~/.emacs.d/.backups"))) ; keep in clean
     (setq backup-by-copying t)                                     ; vs renaming
     (put 'narrow-to-region 'disabled nil)			       ; enable narrowing C-x n n
   #+END_SRC

** Fonts

   =list-fontsets= to see available installed fonts.

   Some good programming fonts [[https://blog.checkio.org/top-10-most-popular-coding-fonts-5f6e65282266?imm_mid=0f5f86][here]].

   1. Inconsolata
   2. Fira Mono
   3. Source Code Pro
   4. Anonymous Pro
   5. M+ 1M
   6. Hack
   7. *DejaVu Sans Mono*
   8. Droid Sans Mono
   9. Ubuntu Mono
   10. Bitsream Vera Sans Mono

   #+BEGIN_SRC emacs-lisp
     ;; Test char and monospace:
     ;; 0123456789abcdefghijklmnopqrstuvwxyz [] () :;,. !@#$^&*
     ;; 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ {} <> "'`  ~-_/|\?

     ;; (set-face-attribute 'default t :font "DejaVu Sans Mono" :height +1)
     (setq default-font-name nil)
     (cond
      ((find-font (font-spec :name "DejaVu Sans Mono"))
       (setq default-font-name "DejaVu Sans Mono")
       (setq default-font-size "12"))

      ((find-font (font-spec :name "Consolas"))
       (setq default-font-name "Consolas")
       (setq default-font-size "13"))
 
      ;; (set-frame-font "DejaVu Sans Mono-12"))
      ;; ((find-font (font-spec :name "Lucida Console"))
      ;;  (set-frame-font "Lucida Console-12"))
      ;; (setq default-font-name "Lucida Console"))
      ((find-font (font-spec :name "Courier New"))
       ;; (set-frame-font "Courier New-12"))
       (setq default-font-name "Courier New")
       (setq default-font-size "12"))
      )
     (when default-font-name
       (add-to-list 'default-frame-alist
		    (cons 'font (concat default-font-name
					"-"
					(or default-font-size "12")))))
     ;; (set-face-attribute 'default t :family "Monospace" :height +1)
   #+END_SRC

*** Try a font
    #+BEGIN_SRC emacs-lisp :tangle no :results output silent
      ;; (set-frame-font "Lucida Console-14")
      (set-frame-font "Consolas-13")
    #+END_SRC

*** Look at installed fonts
    #+BEGIN_SRC emacs-lisp :tangle no :results output silent
    (x-select-font nil t)
    #+END_SRC

** Themes

   - /Custom Themes/ (not /color-themes/) can be loaded and stacked using =load-theme=.
   - Loaded themes must be unloaded individually by =disable-theme=.
   - Both allow tab-completion for applicable themes.
   - [ ] write script to cycle through installed themes at keypress?
   
   #+BEGIN_SRC emacs-lisp
     (unless custom-enabled-themes
       (load-theme 'material t nil))		; load & enable theme, if nothing already set

     (setq custom-safe-themes
	   (quote
	("5999e12c8070b9090a2a1bbcd02ec28906e150bb2cdce5ace4f965c76cf30476" "a4c9e536d86666d4494ef7f43c84807162d9bd29b0dfd39bdf2c3d845dcc7b2e" "c72a772c104710300103307264c00a04210c00f6cc419a79b8af7890478f380e" "555c5a7fa39f8d1538501cc3fdb4fba7562ec4507f1665079021870e0a4c57d8" "3e8ea6a37f17fd9e0828dee76b7ba709319c4d93b7b21742684fadd918e8aca3" "5dc0ae2d193460de979a463b907b4b2c6d2c9c4657b2e9e66b8898d2592e3de5" "04dd0236a367865e591927a3810f178e8d33c372ad5bfef48b5ce90d4b476481" "5e3fc08bcadce4c6785fc49be686a4a82a356db569f55d411258984e952f194a" "7153b82e50b6f7452b4519097f880d968a6eaf6f6ef38cc45a144958e553fbc6" "08b8807d23c290c840bbb14614a83878529359eaba1805618b3be7d61b0b0a32" "98cc377af705c0f2133bb6d340bf0becd08944a588804ee655809da5d8140de6" "130319ab9b4f97439d1b8fd72345ab77b43301cf29dddc88edb01e2bc3aff1e7" "43c1a8090ed19ab3c0b1490ce412f78f157d69a29828aa977dae941b994b4147" "5dd70fe6b64f3278d5b9ad3ff8f709b5e15cd153b0377d840c5281c352e8ccce" "7356632cebc6a11a87bc5fcffaa49bae528026a78637acd03cae57c091afd9b9" "ab04c00a7e48ad784b52f34aa6bfa1e80d0c3fcacc50e1189af3651013eb0d58" "a0feb1322de9e26a4d209d1cfa236deaf64662bb604fa513cca6a057ddf0ef64" default)))
   #+END_SRC

** UTF-8

   #+BEGIN_SRC emacs-lisp
     (setq PYTHONIOENCODING "utf-8")        ;print utf-8 in shell
     (prefer-coding-system 'utf-8)

     ;; Unicode characters cause some windows systems to hang obnoxiously
     ;; (Easily noticed in large org-mode files using org-bullets package.)
     ;; https://github.com/purcell/emacs.d/issues/273
     (when (eq system-type 'windows-nt)
       (setq inhibit-compacting-font-caches t))
   #+END_SRC

** ibuffer

   #+BEGIN_SRC emacs-lisp
     (define-key global-map "\C-x\C-b" 'ibuffer) ; 

     (setq ibuffer-saved-filter-groups
       (quote
	(("ibuffer-filter-groups"
	  ("Notebooks"
	   (name . "\\*ein:.*"))
	  ("Python"
	   (used-mode . python-mode))
	  ("org"
	   (used-mode . org-mode))
	  ("dirs"
	   (used-mode . dired-mode))))))

     (setq ibuffer-saved-filters
       (quote
	(("gnus"
	  ((or
	    (mode . message-mode)
	    (mode . mail-mode)
	    (mode . gnus-group-mode)
	    (mode . gnus-summary-mode)
	    (mode . gnus-article-mode))))
	 ("programming"
	  ((or
	    (mode . emacs-lisp-mode)
	    (mode . cperl-mode)
	    (mode . c-mode)
	    (mode . java-mode)
	    (mode . idl-mode)
	    (mode . lisp-mode)))))))
   #+END_SRC

* Packages
  
  If there is a compile error, or "tar not found," try
  =package-refresh-contents= to refresh the package database.

** selected-packages
    =package-selected-packages= is used by ‘package-autoremove’ to decide
    which packages are no longer needed.
    You can use it to (re)install packages on other machines
    by running ‘package-install-selected-packages’.

    #+BEGIN_SRC emacs-lisp :tangle no
      (setq package-selected-packages
	    (quote
	     (org-bullets tangotango-theme leuven-theme eziam-theme alect-themes
			  atom-one-dark-theme borland-blue-theme material-theme
			  helm helm-projectile expand-region org-projectile
			  projectile web-mode)))
    #+END_SRC

*** TODO Superceded by =use-package=?

** expand-region

   Example of how =use-package= can replace =require= and
   =global-set-key=.

   #+BEGIN_SRC emacs-lisp
     (use-package expand-region
       :ensure t
       :defer 1
       :bind ("C-=" . er/expand-region))
   #+END_SRC

** wrap-region

   http://pragmaticemacs.com/emacs/wrap-text-in-custom-characters/

  #+BEGIN_SRC emacs-lisp
    (use-package wrap-region
      :ensure t
      :defer 1
      :config
      (wrap-region-add-wrappers
       '(("*" "*" nil org-mode)
	 ("~" "~" nil org-mode)
	 ("/" "/" nil org-mode)
	 ("=" "=" ":" org-mode) ; Avoid conflict with expand-region, use ':'
	 ("+" "+" "+" org-mode)
	 ("_" "_" nil org-mode)))
	 ;; ("$" "$" nil (org-mode latex-mode))
      (add-hook 'org-mode-hook 'wrap-region-mode))

  #+END_SRC 

** projectile
   
   #+BEGIN_SRC emacs-lisp
     (use-package projectile
       :ensure t				; ensure package is downloaded
       :defer t
       :init					; pre-load config
       (setq projectile-enable-caching t)	; resolve missing projects
       ;; (projectile-mode +1)			; global projectil mode
       :config nil				; post-load config
       )
   #+END_SRC  

** org-bullets

   https://thraxys.wordpress.com/2016/01/14/pimp-up-your-org-agenda/

   #+BEGIN_SRC emacs-lisp
     (use-package org-bullets
       :ensure t
       :defer 1
       :init
       (add-hook 'org-mode-hook (lambda () (org-bullets-mode t)))
       ;;  (setq org-bullets-bullet-list '("◉" "◎" "○" "►" "◇"))
       :config
       )

   #+END_SRC

** magit
   A Git version control interface.
   
   #+BEGIN_SRC emacs-lisp
     (use-package magit
       :ensure t
       :defer t
       :bind ("C-x g" . magit-status)
       )
   #+END_SRC
   
** themes

   Placeholder to put themes 100% decided on.

   Currently enjoy:
   - leuven-theme
   - material-theme
   - spacemacs-theme

   #+BEGIN_SRC emacs-lisp
     ;; (use-package flatland-theme
     ;;   :ensure t)
     ;; (use-package doom-themes)
   #+END_SRC

** paredit
   http://danmidwood.com/content/2014/11/21/animated-paredit.html

   #+BEGIN_SRC emacs-lisp
     (use-package paredit
       :ensure t
       :defer t)
   #+END_SRC

** smartparens
   #+BEGIN_SRC emacs-lisp
     (use-package smartparens
       :ensure t
       :defer t
       :init
       :config
     )
   #+END_SRC

** which-key
   Gentle reminders and added discoverability.
   #+BEGIN_SRC emacs-lisp
     (use-package which-key
       :ensure t
       :config
       (which-key-mode))

   #+END_SRC

** ein
   Jupyter Notebooks in emacs!  Added [2017-10-19 Thu]
   #+BEGIN_SRC emacs-lisp
     ;; Jupyter python  ;added 2017-10-17
     (use-package ein
       :ensure t
       :defer t
       ;; :backends ein:company-backend
       :init
       (require 'ein-connect)     ; not sure why this is needed suddenly..?
  
       ;; Fix "Null value passed to ein:get-ipython-major-version" #work pc
       ;; https://github.com/millejoh/emacs-ipython-notebook/issues/176
       (ein:force-ipython-version-check)
  
       :config
       ;; (advice-add 'request--netscape-cookie-parse :around #'fix-request-netscape-cookie-parse)
       (setq ein:completion-backend 'ein:use-ac-jedi-backend)
       )

   #+END_SRC

** jedi
   #+BEGIN_SRC emacs-lisp
     (use-package jedi
	 :ensure t
	 :defer t
	 :init
	 :config
	 ;; (setq jedi:complete-on-dot t)
	 ;; (add-hook 'python-mode-hook 'jedi:setup)
	 )

   #+END_SRC

** company
   
   #+BEGIN_SRC emacs-lisp
     (use-package company
       :ensure t
       :defer 2
       :init
       (add-hook 'ein:connect-mode-hook 'ein:jedi-setup)
       (add-hook 'python-mode-hook 'company-mode)
       ;; (add-hook 'ein:connect-mode-hook 'company-mode) ; Can't figure out company-jedi + ein

       :config
       (use-package company-jedi)
       (use-package company-quickhelp)
       (company-quickhelp-mode 1)
       (add-to-list 'company-backends 'company-jedi)
       (setq company-idle-delay 0.5)
       (setq company-minimum-prefix-length 2)
       )
   #+END_SRC

** smartscan

   #+BEGIN_SRC emacs-lisp
	  (use-package smartscan
	    :ensure t
	    :defer 1
	    :bind (("M-n" . smartscan-symbol-go-forward)
		   ("M-p" . smartscan-symbol-go-backward))
	    )
   #+END_SRC

** org2blog
   - [[https://github.com/org2blog/org2blog][org2blog]]
   #+BEGIN_SRC emacs-lisp
     (use-package org2blog
       :ensure t
       :defer 1
       :init
       :config
       ;; see init_private.el
       )
   #+END_SRC

** beacon
   #+BEGIN_SRC emacs-lisp
     (use-package beacon
       :ensure t
       :init
       (beacon-mode 1))
   #+END_SRC

** spaceline (powerline) modeline
   #+BEGIN_SRC emacs-lisp
     (use-package spaceline
       :ensure t
       :config
       (require 'spaceline-config)
       (setq powerline-default-separator 'wave)
       (spaceline-spacemacs-theme))
   #+END_SRC

** TODO origami-mode
** TODO multi-cursors
** TODO helm
** TODO gnus
** TODO erc
   - https://www.emacswiki.org/emacs/EmacsChannel

* Dired

  Let =dired= try to guess target (copy and rename ops) directory when
  two =dired= buffers open.

  Also useful:
  - writeable dired: 
  - 

  #+BEGIN_SRC emacs-lisp
    (setq dired-dwim-target t)		; guess target directory

  #+END_SRC

* Org Mode
** TODO use conditional environment variables (env: home/work os:win/linux)
   https://stackoverflow.com/questions/17537124/how-to-declare-the-location-of-emacss-init-file-as-a-variable

   #+BEGIN_SRC emacs-lisp :tangle no
     ;; elisp note on conditionally setting variable
     (setq 'my-list-depending-on-system
	   (cond
	    ((string-equal system-type "windows-nt")
	     '(
	       "item 1 windows"
	       "item 2 windows"
	       ))
	    ((string-equal system-type "gnu/linux")
	     '(
	       "item 1 linux"
	       "item 2 linux"
	       ))
	    ))
   #+END_SRC

** Export

   - http://orgmode.org/manual/Export-settings.html#Export-settings

   #+BEGIN_SRC emacs-lisp
     ;; (org-export-creator-string)
     ;; (org-export-with-creator)
     ;; TODO: remove creator string and validation link in footer
     ;; (setq org-export-html-postabmle nil) <-- deprecated
     ;; #+OPTIONS
     (setq org-export-initial-scope "subtree")
     ;; (org-html-head)
   #+END_SRC

** Files
   - [ ] Use platform independent home directory.  (getenv "HOMEPATH")
   #+BEGIN_SRC emacs-lisp
     ;; (add-to-list 'load-path "~/../or
     ;; my/org-directory defined in init_private.el
     (setq org-agenda-files (list
			     (concat my/org-directory "/notes.org")    ; Home/Learn/Everything
			     (concat my/org-directory "/work.org")     ; Work                 
			     (concat my/org-directory "/agenda.org")))  ; Life Stuff - rename to 'personal'?

     (setq org-default-notes-file (concat my/org-directory "/captured.org")) ; Unsorted  Notes
   #+END_SRC

** Capture

   - [[https://www.gnu.org/software/emacs/manual/html_node/org/Template-elements.html][Capture Template Elements]]

   #+BEGIN_SRC emacs-lisp
     (setq org-capture-templates
	   '(("t"				; key
	      "Task"				; description
	      entry				; type
	      ;; heading type and title
	      (file+headline org-default-notes-file "Tasks") ; target
	      "* TODO %?\n  %i\n  %a"	; template
	      ;; optional property list  ; properties
	      )
	     ("j"
	      "Learning Journal"
	      entry
	      (file+datetree org-default-notes-file "Learning Journal")
	      "* %?\nEntered on %U\n  %i\n  %a" ; %a stores link, %i is active region
	      )
	     ))
   #+END_SRC

** Other
   #+BEGIN_SRC emacs-lisp
     (setq org-ellipsis "◿")			;⤵, ▐, ►, ▽, ◿, ◹, », ↵, ≋, …, ⋞, ⊡, ⊹, ⊘

     ;; fontify (pretty formating) code in code blocks
     (setq org-src-fontify-natively t)	; important for init.org !

     (setq org-refile-targets (quote ((org-agenda-files :level . 2))))
     (setq org-refile-use-outline-path 'file)

     ;; org-mode customization
     (setq org-log-done 'time)  ;; 
     (setq org-todo-keywords
	    '((sequence "TODO(t)" "STARTD(s)" "WAITING(w)" "|" "DONE(d)" "DELEGATED(e)" "CANCELLED(c)")))

     ;org-mode keybindings
     (define-key global-map "\C-cc" 'org-capture)    ; todo: move to use-package :bind ?
     (define-key global-map "\C-ca" 'org-agenda)     ; 
     (define-key global-map "\C-cl" 'org-store-link) ; 
   #+END_SRC

** Agenda
   #+BEGIN_SRC emacs-lisp
   (setq org-agenda-skip-scheduled-if-deadline-is-shown t)
   
   #+END_SRC

* Windows
** External Programs
*** Spelling & Dictionaries (aspell/ispell/hunspell)

    - WINDOWS: install hunspell from cygwin, add code below, and update
      dictionaries to handle apostrophes. ie. =echo I'm | hunspell -d en_CA=

    - THANK YOU, ALEX
      - http://gromnitsky.blogspot.ca/2016/09/emacs-251-hunspell.html
    
    - Updated dict from openoffice to handle apostrophes:
      - https://extensions.openoffice.org/en/project/dict-en-fixed
      - (via https://sourceforge.net/p/hunspell/patches/35/)


    #+BEGIN_SRC emacs-lisp
      (setenv "LANG" "en_CA.UTF-8")
      (setq-default ispell-program-name "hunspell")
      (setq ispell-dictionary "en_CA")
    #+END_SRC

*** Cygwin

    https://www.emacswiki.org/emacs/NTEmacsWithCygwin#toc2

    #+BEGIN_SRC emacs-lisp
      ;; Sets your shell to use cygwin's bash, if Emacs finds it's running
      ;; under Windows and c:\cygwin exists. Assumes that C:\cygwin\bin is
      ;; not already in your Windows Path (it generally should not be).
      ;;

      (if (string-match-p (regexp-quote "steven.brown") (getenv "USERPROFILE"))
	  (setq my/env "work")
	(setq my/env "personal"))


      (let* ((cygwin-root (if (string-equal my/env "work")
			      "c:/Users/steven.brown/Apps/cygwin64" ; work
			    "c:/Program Files/cygwin64"))	      ; home
	     (cygwin-bin (concat cygwin-root "/bin")))
	(when (and (eq 'windows-nt system-type)
		   (file-readable-p cygwin-root))

	  (setq exec-path (cons cygwin-bin exec-path))
	  (setenv "PATH" (concat cygwin-bin ";" (getenv "PATH")))

	  ;; By default use the Windows HOME.
	  ;; Otherwise, uncomment below to set a HOME
	  ;;      (setenv "HOME" (concat cygwin-root "/home/eric")) ;TODO: Customize by environment

	  ;; NT-emacs assumes a Windows shell. Change to bash.
	  (setq shell-file-name "bash")
	  (setenv "SHELL" shell-file-name) 
	  (setq explicit-shell-file-name shell-file-name) 

	  ;; This removes unsightly ^M characters that would otherwise
	  ;; appear in the output of java applications.
	  (add-hook 'comint-output-filter-functions 'comint-strip-ctrl-m)

	  ;; explicitly set dictionary path
	  (setq ispell-hunspell-dict-paths-alist
		`(("en_CA" ,(concat (file-name-as-directory cygwin-root) "usr/share/myspell/en_CA.aff"))
		  ("en_US" ,(concat (file-name-as-directory cygwin-root) "usr/share/myspell/en_US.aff"))
		  ("en_GB" ,(concat (file-name-as-directory cygwin-root) "usr/share/myspell/en_GB.aff"))
		  ))
	  ))			       
    #+END_SRC

* Notes

  | Key       | What                                                |
  |-----------+-----------------------------------------------------|
  | C-c '     | narrow on code block in sibling window (and return) |
  | C-c C-v t | tangle                                              |
  | C-c C-v f | tangle into specific filename, like "init.el"       |

  *Converting from .emacs or init.el*
  : (custom-set-variables
  :  '(my-variable value)
  :  '(column-number-mode t)
  :  ; ...		     
  : )		     
  : 		     

  -->

  : (setq column-number-mode t) 

  Reference:

  - https://github.com/howardabrams/dot-files/blob/master/emacs-client.org \
    sanityinc-tomorrow-theme
  - [[http://pages.sachachua.com/.emacs.d/Sacha.html][Sacha Chua init.org]]
  - https://www.masteringemacs.org/article/running-shells-in-emacs-overview \
    You *must* set extra variables if customizing shell on Windows....
  - https://github.com/daedreth/UncleDavesEmacs


